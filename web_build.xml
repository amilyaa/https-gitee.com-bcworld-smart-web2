<?xml version="1.0" encoding="UTF-8"?>
<project name="SmartWeb" default="release.smart.web" basedir=".">
	<!-- 基本信息 -->
	<property name="version" value="1.0" />
	<property name="base" value="." />
	<property name="user.home" value="/home/lmq" />
	<property name="source.src.dir" value="${base}/src" />
	<property name="source.res.sql.dir" value="${base}/src/resources/sql" />
		
	<property name="source.lib.dir" value="${base}/WebRoot/WEB-INF/lib" />
	<property name="source.webRoot.dir" value="${base}/WebRoot" />
	<!--WEB 资源目录(css,js,images等)-->
	<property name="source.webRoot.css.dir" value="${source.webRoot.dir}/css" />
	<property name="source.webRoot.images.dir" value="${source.webRoot.dir}/images" />
	<property name="source.webRoot.js.dir" value="${source.webRoot.dir}/js" />
	<property name="source.webRoot.plugins.dir" value="${source.webRoot.dir}/plugins" />
	<!--web页面目录-->
	<property name="source.webRoot.webInfo.dir" value="${source.webRoot.dir}/WEB-INF" />
	<property name="source.webInfo.contents.dir" value="${source.webRoot.webInfo.dir}/contents" />
	<property name="source.webInfo.base.dir" value="${source.webInfo.contents.dir}/base" />
	<property name="source.web.lib.dir" value="${source.webRoot.webInfo.dir}/lib" />
	
	<!--tomcat服务器配置-->
	<property name="tomcat.path.dir" value="${user.home}/datas/work/tomcat/apache-tomcat-7.0.75"></property>
	<property name="tomcat.path.lib.dir" value="${tomcat.path.dir}/lib"/>

	<!-- 目的配置 -->
	<property name="build.dir" value="${user.home}/build/SmartWeb" />
	<property name="build.classes.dir" value="${build.dir}/classes" />
	<property name="build.jar.filename" value="smart-web.jar" />
		
	<property name="build.javadoc.dir" value="${build.dir}/javadoc" />
	<property name="build.javadoc.filename" value="smart-web-javadoc.jar" />
	
	<property name="build.meta.dir" value="${build.classes.dir}/META-INF" />
	<property name="build.meta.resources.dir" value="${build.meta.dir}/resources" />
	<!---->
	<property name="build.webRoot.css.dir" value="${build.meta.resources.dir}/css" />
	<property name="build.webRoot.images.dir" value="${build.meta.resources.dir}/images" />
	<property name="build.webRoot.js.dir" value="${build.meta.resources.dir}/js" />
	<property name="build.webRoot.plugins.dir" value="${build.meta.resources.dir}/plugins" />
	<!---->
	<property name="build.meta.webInfo.dir" value="${build.meta.resources.dir}/WEB-INF" />
	<property name="build.webInfo.contents.dir" value="${build.meta.webInfo.dir}/contents" />
	<property name="build.webInfo.base.dir" value="${build.webInfo.contents.dir}/base" />

	<path id="compile.classpath">
		<fileset dir="${source.web.lib.dir}">
			<include name="*.jar" />
		</fileset>
		<pathelement path="${source.web.lib.dir}" />
		<fileset dir="${tomcat.path.lib.dir}">
			<include name="*.jar" />
		</fileset>
	</path>

	<target name="init">
		<deltree dir="${build.dir}" />
		<mkdir dir="${build.dir}" />
		<mkdir dir="${build.classes.dir}" />
		<mkdir dir="${build.meta.dir}"/>
		<mkdir dir="${build.meta.resources.dir}"/>
		<mkdir dir="${build.webRoot.css.dir}"/>
		<mkdir dir="${build.webRoot.images.dir}"/>
		<mkdir dir="${build.webRoot.js.dir}"/>
		<mkdir dir="${build.webRoot.plugins.dir}"/>
						
		<mkdir dir="${build.meta.webInfo.dir}"/>
		<mkdir dir="${build.webInfo.contents.dir}"/>
		<mkdir dir="${build.webInfo.base.dir}"/>
	</target>
	
	<target name="build.core" depends="init">
		<javac source="1.6" target="1.6" debug="on" 
			deprecation="false" optimize="false" failonerror="true"
			destdir="${build.classes.dir}" encoding="utf-8" >
			<src path="${source.src.dir}/base"></src>
			<src path="${source.src.dir}/web"></src>
			<classpath refid="compile.classpath" />
		</javac>
	</target>
	
	<target name="build.core.doc" depends="init">
		<javadoc destdir="${build.javadoc.dir}" encoding="utf-8" docencoding="utf-8">
			<packageset dir="${source.src.dir}/base">
				<include name="**"/>
		   </packageset>
		    <packageset dir="${source.src.dir}/web">
				<include name="**"/>
			</packageset>
			<classpath refid="compile.classpath" />
		</javadoc>
	</target>
		
	<target name="copy.file">
		<copyfile dest="${build.meta.dir}/cnoj-tags.tld" src="${source.webRoot.dir}/WEB-INF/cnoj-tags.tld" />
		<copyfile dest="${build.classes.dir}/base_sql_res.xml" src="${source.res.sql.dir}/base_sql_res.xml" />
		<copyfile dest="${build.classes.dir}/op_sql_res.xml" src="${source.res.sql.dir}/op_sql_res.xml" />
		<copyfile dest="${build.classes.dir}/web_sql_res.xml" src="${source.res.sql.dir}/web_sql_res.xml" />
		
		<copydir dest="${build.webRoot.css.dir}" src="${source.webRoot.css.dir}" />
		<copydir dest="${build.webRoot.js.dir}" src="${source.webRoot.js.dir}" />
		<copydir dest="${build.webRoot.images.dir}" src="${source.webRoot.images.dir}" />
		<copydir dest="${build.webRoot.plugins.dir}" src="${source.webRoot.plugins.dir}" excludes="form/**,flow/**,ueditor/**" />
		
		<copydir dest="${build.webInfo.base.dir}" src="${source.webInfo.base.dir}" />
	</target>
	
	<target name="build.jar" depends="build.core,copy.file,build.core.doc">
		<jar destfile="${build.dir}/${build.jar.filename}" basedir="${build.classes.dir}" />
		<jar destfile="${build.dir}/${build.javadoc.filename}" basedir="${build.javadoc.dir}" />
		<deltree dir="${build.classes.dir}" />
		<deltree dir="${build.javadoc.dir}" />
	</target>

	<target name="release.smart.web" depends="build.jar">
	</target>
</project>